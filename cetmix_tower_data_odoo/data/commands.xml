<?xml version="1.0" encoding="utf-8" ?>
<odoo>

    <record id="command_odoo_dir_create" model="cx.tower.command">
        <field name="readonly">True</field>
        <field name="name">Odoo Directories - Create</field>
        <field
            name="tag_ids"
            eval="[(6, 0, [ref('cetmix_tower_data_odoo.tag_cetmix_tower_data_odoo')])]"
        />
        <field name="code">
mkdir -p {{ odoo_path_data }} &amp;&amp; \
mkdir -p {{ odoo_path_dockerfile }} &amp;&amp; \
mkdir -p {{ odoo_path_config }} &amp;&amp; \
{% if odoo_path_src_manual %} \
mkdir -p {{ odoo_path_src_manual }} \
{% endif %}
{% if odoo_path_src_auto %} \
mkdir -p {{ odoo_path_src_auto }} \
{% endif %}

        </field>
    </record>

    <record id="command_odoo_dir_set_ownership" model="cx.tower.command">
        <field name="readonly">True</field>
        <field name="name">Odoo Directories - Set ownership</field>
        <field
            name="tag_ids"
            eval="[(6, 0, [ref('cetmix_tower_data_odoo.tag_cetmix_tower_data_odoo')])]"
        />
        <field name="code">
chown -R {{ odoo_dir_uid }}:{{ odoo_dir_gid }} {{ odoo_path_data }} \
&amp;&amp; \
chown -R {{ odoo_dir_uid }}:{{ odoo_dir_gid }} {{ odoo_path_config }}

        </field>
    </record>

    <record id="command_odoo_docker_container_create_start" model="cx.tower.command">
        <field name="readonly">True</field>
        <field name="name">Odoo container - Full Start</field>
        <field
            name="tag_ids"
            eval="[(6, 0, [ref('cetmix_tower_data_odoo.tag_cetmix_tower_data_odoo')])]"
        />
        <field name="code">
docker run -d \
-v {{ odoo_path_data }}:{{ odoo_conf_data_dir }} \
-v {{ odoo_path_config }}/odoo.conf:/etc/odoo/odoo.conf \
{% if odoo_path_auto_addons %}
-v {{ odoo_path_auto_addons }}:/opt/odoo/auto/addons \
{% endif %}
{% if odoo_path_src_auto %}
-v {{ odoo_path_src_auto }}:/opt/odoo/custom/src \
{% endif %}
{% if odoo_path_src_manual %}
-v {{ odoo_path_src_manual }}:/src \
{% endif %}
--link {{ postgres_instance }}:{{ postgres_instance }} \
--name {{ odoo_instance }} \
--restart {{ odoo_restart_policy }} \
--label "traefik.enable=true" \
--label "traefik.http.routers.{{ odoo_instance }}.rule=Host(\`{{ odoo_website_domain }}\`)" \
--label "traefik.http.routers.{{ odoo_instance }}.tls.certresolver=myresolver" \
--label "traefik.http.services.{{ odoo_instance }}.loadbalancer.server.port=8069" \
-t \
{{ odoo_image }} \
--database {{ odoo_instance }} {% if odoo_config_override %} {{ odoo_config_override }} {% endif %}

        </field>
    </record>

    <record id="command_odoo_docker_container_stop_remove" model="cx.tower.command">
        <field name="readonly">True</field>
        <field name="name">Odoo container - Full Stop</field>
        <field
            name="tag_ids"
            eval="[(6, 0, [ref('cetmix_tower_data_odoo.tag_cetmix_tower_data_odoo')])]"
        />
        <field name="code">
docker stop {{ odoo_instance}} &amp;&amp; docker rm {{ odoo_instance}}
        </field>
    </record>

    <record id="command_odoo_docker_container_restart" model="cx.tower.command">
        <field name="readonly">True</field>
        <field name="name">Odoo Container - Restart</field>
        <field
            name="tag_ids"
            eval="[(6, 0, [ref('cetmix_tower_data_odoo.tag_cetmix_tower_data_odoo')])]"
        />
        <field name="code">
docker restart {{ odoo_instance }}
        </field>
    </record>

    <record id="command_odoo_docker_image_build" model="cx.tower.command">
        <field name="readonly">True</field>
        <field name="name">Odoo image - Build</field>
        <field
            name="tag_ids"
            eval="[(6, 0, [ref('cetmix_tower_data_odoo.tag_cetmix_tower_data_odoo')])]"
        />
        <field name="code">
docker build {{ odoo_path_dockerfile }} --tag "{{ odoo_image }}" \
--no-cache \
--build-arg ODOO_VERSION={{ odoo_version }} \
--build-arg GITHUB_TOKEN=#!cxtower.secret.GITHUB_TOKEN!#

        </field>
    </record>

    <record id="command_odoo_docker_image_remove" model="cx.tower.command">
        <field name="readonly">True</field>
        <field name="name">Odoo image - Remove</field>
        <field
            name="tag_ids"
            eval="[(6, 0, [ref('cetmix_tower_data_odoo.tag_cetmix_tower_data_odoo')])]"
        />
        <field name="code">
docker image rm {{ odoo_image }}

        </field>
    </record>

</odoo>
