<?xml version="1.0" encoding="utf-8" ?>
<odoo>

    <record id="command_traefik_docker_run" model="cx.tower.command">
        <field name="readonly">True</field>
        <field name="name">Traefik - Create / Run container</field>
        <field
            name="tag_ids"
            eval="[(6, 0, [ref('cetmix_tower_data_traefik.tag_cetmix_tower_data_traefik')])]"
        />
        <field name="code">
docker run -d \
  --name {{ traefik_instance }} \
  -p 80:80 \
  -p 443:443 \
  -v {{ traefik_volume }}:/etc/traefik/acme:rw,Z \
  -v /var/run/docker.sock:/var/run/docker.sock:ro \
  {{ traefik_image}} \
  --certificatesresolvers.myresolver.acme.httpchallenge=true \
  --certificatesresolvers.myresolver.acme.httpchallenge.entrypoint=web \
  --certificatesresolvers.myresolver.acme.caserver={{ traefik_url }} \
  --certificatesresolvers.myresolver.acme.email={{ traefik_email }} \
  --certificatesresolvers.myresolver.acme.storage=/etc/traefik/acme/acme.json \
  --entryPoints.web.address=:80 \
  --entrypoints.web.http.redirections.entryPoint.to=websecure \
  --entrypoints.web.http.redirections.entryPoint.scheme=https \
  --entryPoints.websecure.address=:443 \
  --log.level={{ traefik_log_level }} \
  --providers.docker.exposedbydefault=false

        </field>
    </record>

    <record id="command_traefik_docker_rm" model="cx.tower.command">
        <field name="readonly">True</field>
        <field name="name">Traefik - Stop / Remove container</field>
        <field
            name="tag_ids"
            eval="[(6, 0, [ref('cetmix_tower_data_traefik.tag_cetmix_tower_data_traefik')])]"
        />
        <field name="code">
docker stop {{ traefik_instance }} &amp;&amp; \
docker rm {{ traefik_instance }}

        </field>
    </record>

</odoo>
