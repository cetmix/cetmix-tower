<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils: https://docutils.sourceforge.io/" />
<title>Cetmix Tower Server Management</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 9511 2024-01-13 09:50:07Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.
Despite the name, some widely supported CSS2 features are used.

See https://docutils.sourceforge.io/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

.subscript {
  vertical-align: sub;
  font-size: smaller }

.superscript {
  vertical-align: super;
  font-size: smaller }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left, table.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right, table.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

table.align-center {
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

.align-top    {
  vertical-align: top }

.align-middle {
  vertical-align: middle }

.align-bottom {
  vertical-align: bottom }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: gray; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic, pre.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

/* "booktabs" style (no vertical lines) */
table.docutils.booktabs {
  border: 0px;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.docutils.booktabs * {
  border: 0px;
}
table.docutils.booktabs th {
  border-bottom: thin solid;
  text-align: left;
}

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="cetmix-tower-server-management">
<h1 class="title">Cetmix Tower Server Management</h1>

<!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!! This file is generated by oca-gen-addon-readme !!
!! changes will be overwritten.                   !!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!! source digest: sha256:ea016a8e095046948647a088ec460f212b36c88c581fbdb5e71922e8aca49864
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->
<p><a class="reference external image-reference" href="https://odoo-community.org/page/development-status"><img alt="Beta" src="https://img.shields.io/badge/maturity-Beta-yellow.png" /></a> <a class="reference external image-reference" href="http://www.gnu.org/licenses/agpl-3.0-standalone.html"><img alt="License: AGPL-3" src="https://img.shields.io/badge/licence-AGPL--3-blue.png" /></a> <a class="reference external image-reference" href="https://github.com/cetmix/cetmix-tower/tree/14.0-dev/cetmix_tower_server"><img alt="cetmix/cetmix-tower" src="https://img.shields.io/badge/github-cetmix%2Fcetmix--tower-lightgray.png?logo=github" /></a></p>
<p><a class="reference external" href="http://cetmix.com/tower">Cetmix Tower</a> offers a streamlined solution
for managing remote servers via SSH or API calls directly from
<a class="reference external" href="https:/odoo.com">Odoo</a>. It is designed for versatility across
different operating systems and software environments, providing a
practical option for those looking to manage servers without getting
tied down by vendor or technology constraints.</p>
<div class="section" id="why-cetmix-tower">
<h1>Why Cetmix Tower?</h1>
<ul class="simple">
<li><strong>Open Source:</strong> <a class="reference external" href="http://cetmix.com/tower">Cetmix Tower</a> is
distributed under the AGPL-3 license</li>
<li><strong>Odoo Integration:</strong> Benefit from <a class="reference external" href="https:/odoo.com">Odoo</a>
ecosystem for server management tasks, like deploying servers in
response to specific Odoo-triggered events</li>
<li><strong>Extendability:</strong> Build your own <a class="reference external" href="https:/odoo.com">Odoo</a> modules
using <a class="reference external" href="http://cetmix.com/tower">Cetmix Tower</a> to implement your
custom features</li>
<li><strong>Beyond Odoo:</strong> While optimized for Odoo, Cetmix Tower can manage
virtually any instance</li>
<li><strong>Flexibility:</strong> Use Cetmix Tower alongside other management methods
without restriction, ensuring you’re not limited to a single vendor</li>
<li><strong>Self-Hosting:</strong> Deploy Cetmix Tower on your own infrastructure for
full control over your server management.</li>
<li><strong>Broad Compatibility:</strong> Execute any software that’s manageable via
shell commands or API. From Docker or Kubernetes to direct OS package
installations</li>
</ul>
</div>
<div class="section" id="server-management">
<h1>Server Management</h1>
<ul class="simple">
<li>Variable based flexible configuration</li>
<li>Create servers using pre-defined templates</li>
</ul>
</div>
<div class="section" id="connectivity">
<h1>Connectivity</h1>
<ul class="simple">
<li>Password and key based authentication for outgoing SSH connections</li>
<li>Built-in support of the Python <a class="reference external" href="https://pypi.org/project/requests/">requests
library</a> for outgoing API
calls</li>
</ul>
</div>
<div class="section" id="commands">
<h1>Commands</h1>
<ul class="simple">
<li>Execute SSH commands on remote servers</li>
<li>Run Python code on the Tower Odoo server</li>
<li>Render commands using variables</li>
<li>Secret keys for private data storage</li>
</ul>
</div>
<div class="section" id="flight-plans">
<h1>Flight Plans</h1>
<ul class="simple">
<li>Execute multiple commands in a row</li>
<li>Condition based flow:<ul>
<li>Based on condition using <a class="reference external" href="https://www.w3schools.com/python/python_syntax.asp">Python
syntax</a></li>
<li>Based on the previous command exit code</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="files">
<h1>Files</h1>
<ul class="simple">
<li>Download files from remote server using SFTP</li>
<li>Upload files to remote server using SFTP</li>
<li>Support for <tt class="docutils literal">text</tt> and <tt class="docutils literal">binary</tt> file format</li>
<li>Manage files using pre-defined file templates</li>
</ul>
</div>
<div class="section" id="support-and-technical-requirements">
<h1>Support and Technical Requirements</h1>
<ul class="simple">
<li>Cetmix Tower with usability and simplicity in mind, though some
features might require a foundational understanding of server
management principles</li>
<li>We offer dedicated support to help with any custom setup needs or
questions that may arise</li>
<li>This module depends on the <a class="reference external" href="http://odoo-community.org">OCA</a> free
<a class="reference external" href="https://github.com/OCA/web/tree/14.0/web_notify">Web Notify</a>
module. Please ensure it is installed in your system for your Odoo
version</li>
<li>For additional details, visit our website
<a class="reference external" href="https://cetmix.com">cetmix.com</a></li>
</ul>
<p><strong>Table of contents</strong></p>
</div>
<div class="section" id="configuration">
<h1>Configuration</h1>
<p>Please ensure that you have read and understood the documentation before
running <a class="reference external" href="https://cetmix.com/tower">Cetmix Tower</a> in the production
environment.</p>
<div class="section" id="user-access-configuration">
<h2>User access configuration</h2>
<p>In order for a user to be able to use <a class="reference external" href="https://cetmix.com/tower">Cetmix
Tower</a> features you need to provide access
to in the the user settings. To configure it go to
<tt class="docutils literal">Setting/Users &amp; Companies/Users</tt> and open a user whom you would like
to provide access to the Cetmix Tower.</p>
<p><img alt="User profile" src="https://raw.githubusercontent.com/cetmix/cetmix-tower/14.0-dev/cetmix_tower_server/static/description/images/user_profile.png" /></p>
<p>In <tt class="docutils literal">Other</tt> section find the <tt class="docutils literal">Cetmix Tower</tt> field and select one of
the following options:</p>
<ul class="simple">
<li><strong>User</strong>. Members of this group have read access only to the
<a class="reference external" href="#configure-a-server">Servers</a> which they are added as followers.
They also have access to the entities such as
<a class="reference external" href="#configure-a-command">Commands</a>, <a class="reference external" href="#configure-a-flight-plan">Flight
Plans</a> or <a class="reference external" href="#configure-a-server-log">Server
Logs</a> with <tt class="docutils literal">Access Level</tt> set to
<tt class="docutils literal">User</tt>.</li>
<li><strong>Manager</strong>. Members of this group can modify
<a class="reference external" href="#configure-a-server">Servers</a> which they are added as followers.
They can create new <a class="reference external" href="#configure-a-server">Servers</a> too however
they cannot delete them. Users of this group have access to the
entities with <tt class="docutils literal">Access Level</tt> set to <tt class="docutils literal">Manager</tt> or <tt class="docutils literal">User</tt>.</li>
<li><strong>Root</strong>. Members of this group can create, modify or delete any
<a class="reference external" href="#configure-a-server">Server</a>. They also have access to the
entities with any <tt class="docutils literal">Access Level</tt> set.</li>
</ul>
<p><strong>NB:</strong> Please keep in mind that some of the entities can have their
additional access management variations.</p>
</div>
<div class="section" id="configure-a-server">
<h2>Configure a Server</h2>
<p>Go to the <tt class="docutils literal">Cetmix Tower/Servers/Servers</tt> menu and click <tt class="docutils literal">Create</tt>.
Enter server name and a unique server reference. Leave the “reference”
field blank to generate a reference automatically. You can also select a
color which is used to mark a server in the kanban view.</p>
<p>Fill the values it the tabs below:</p>
<p><strong>General Settings</strong></p>
<ul class="simple">
<li><strong>Partner</strong>: Partner this server belongs to</li>
<li><strong>Operating System</strong>: Operating system that runs on the server</li>
<li><strong>Tags</strong>: User-defined search tags</li>
<li><strong>IPv4 Address</strong></li>
<li><strong>IPv6 Address</strong>: Will be used if no IPv4 address is specified</li>
<li><strong>SSH Auth Mode</strong>: Available options are “Password” and “Key”</li>
<li><strong>SSH Port</strong></li>
<li><strong>SSH Username</strong></li>
<li><strong>Use sudo</strong>: If sudo is required by default for running all commands
on this server</li>
<li><strong>SSH Password</strong>: Used if Auth Mode is set to “Password” and for
running <tt class="docutils literal">sudo</tt> commands with password</li>
<li><strong>SSH Private Key</strong>: Used for authentication is SSH Auth Mode is set
to “Key”</li>
<li><strong>Note</strong>: Comments or user notes</li>
</ul>
<p>There is a special <strong>Status</strong> field which indicates current Server
status. It is meant to be updated automatically using external API with
further customizations. Following pre-defined statuses are available:</p>
<ul class="simple">
<li>Undefined</li>
<li>Stopped</li>
<li>Starting</li>
<li>Running</li>
<li>Stopping</li>
<li>Restarting</li>
</ul>
<p>Default status is ‘Undefined’.</p>
<p><strong>Configuration</strong></p>
<p>Configure <a class="reference external" href="#configure-variables">configuration variables</a> values to
be used when rendering <a class="reference external" href="#configure-a-command">commands</a> and
<a class="reference external" href="#configure-a-file">files</a> on this server.</p>
<p><strong>Secrets</strong></p>
<p>Configure secret values to used when rendering commands and files on
this server. Check the <a class="reference external" href="#configure-a-keysecret">Configuring
Keys/Secrets</a> section for more details.</p>
<p><strong>Server Logs</strong></p>
<p>Configure server logs in order to have convenient access to them. Logs
can be fetched either from <a class="reference external" href="#configure-a-file">Files</a> or using
<a class="reference external" href="#configure-a-command">Commands.</a> Check the <a class="reference external" href="#configure-a-server-log">Configuring a Server
Log</a> section for more details.</p>
<p>Following action buttons are located in the top of the form:</p>
<ul class="simple">
<li><strong>Command Logs</strong>: Shows all <a class="reference external" href="#configure-a-command">Command</a> logs
for this server</li>
<li><strong>Flight Plan Logs</strong>: Shows all <a class="reference external" href="#configure-a-flight-plan">Flight
Plan</a> logs for this server</li>
<li><strong>Files</strong>: Shows all <a class="reference external" href="#configure-a-file">Files</a> that belong to
this server</li>
</ul>
</div>
<div class="section" id="configure-a-server-template">
<h2>Configure a Server Template</h2>
<p>Go to the <tt class="docutils literal">Cetmix Tower/Servers/Templates</tt> menu and click <tt class="docutils literal">Create</tt>.
Enter template name and a unique template reference. Leave the
“reference” field blank to generate a reference automatically.</p>
<p>Fill the values it the tabs below:</p>
<p><strong>General Settings</strong></p>
<ul class="simple">
<li><strong>Flight Plan</strong>: Select a flight plan to be executed after a server
is created</li>
<li><strong>Operating System</strong>: Default operating system for new servers</li>
<li><strong>Tags</strong>: Default search tags for new servers</li>
<li><strong>SSH Auth Mode</strong>: Default SSH auth mode for new servers. Available
options are “Password” and “Key”</li>
<li><strong>SSH Port</strong>: Default SSH port for new servers</li>
<li><strong>SSH Username</strong>: Default SSH username for new servers</li>
<li><strong>Use sudo</strong>: Default sudo mode for new servers</li>
<li><strong>SSH Password</strong>: Default SSH password for new servers</li>
<li><strong>SSH Private Key</strong>: Default SSH private key for new servers</li>
<li><strong>Note</strong>: Comments or user notes</li>
</ul>
<p><strong>Variables</strong></p>
<p>Configure default variable values for new servers. Check the
<a class="reference external" href="#configure-variables">Configuring Variables</a> section for more
details.</p>
<p><strong>Server Logs</strong></p>
<p>Please check the <a class="reference external" href="#configure-a-server-log">Configuring a Server Log</a>
section for more details.</p>
</div>
<div class="section" id="configure-variables">
<h2>Configure Variables</h2>
<p>To configure variables go to the <tt class="docutils literal">Cetmix Tower/Settings</tt> and select
the <tt class="docutils literal">Variables</tt> menu. Click <tt class="docutils literal">Create</tt> and put values in the fields:</p>
<ul class="simple">
<li><strong>Name</strong>: Readable name</li>
<li><strong>Reference</strong>: Unique identifier used to address variable in
conditions and expressions. Leave blank to generate automatically
based on name</li>
<li><strong>Note</strong>: Put your notes here</li>
</ul>
<div class="section" id="variables-applicability">
<h3>Variables Applicability</h3>
<p><a class="reference external" href="https://cetmix.com/tower">Cetmix Tower</a> supports <tt class="docutils literal">jinja2</tt> syntax
for variables. You can use variables to render:</p>
<ul class="simple">
<li>Commands. Eg <tt class="docutils literal">ls <span class="pre">-lh</span> {{ file_store_location }}</tt></li>
<li>Files. Eg a “Dockerfile” file can have the following text in it:
<tt class="docutils literal">ODOO_VERSION = {{ odoo_default_version }}</tt></li>
<li>File Templates. You can use variables for both file name and file
location on server. Eg <tt class="docutils literal">File Name</tt> value is
<tt class="docutils literal">backup_{{ instance_name }}_{{ odoo_db_name }}</tt> and
<tt class="docutils literal">Directory on server</tt> is <tt class="docutils literal">{{ file_cron_location }}</tt></li>
<li>Other Variables. Eg for an <tt class="docutils literal">odoo_config_location</tt> variable can have
a value of <tt class="docutils literal">{{ <span class="pre">odoo_root}}/conf</span></tt></li>
</ul>
<p>You can use any <tt class="docutils literal">jinja2</tt> supported expressions. For example
<tt class="docutils literal">if else</tt> statements:</p>
<pre class="literal-block">
docker run -d -p {{ odoo_port }}:8069 \
{% if  odoo_longpolling_port and odoo_longpolling_port != '0' and odoo_workers and odoo_workers != '0' %}
    -p {{ odoo_longpolling_port }}:8072 \
{% endif %}
    -v {{ odoo_data }}:/var/lib/odoo \
{% if  odoo_config_location %}
    -v {{ odoo_config_location }}:/etc/odoo \
{% endif %}
</pre>
</div>
<div class="section" id="variable-rendering-modes">
<h3>Variable Rendering Modes</h3>
<p>There are two rendering modes available:</p>
<ul class="simple">
<li>Generic (or ssh) mode</li>
<li>Pythonic mode</li>
</ul>
<p>Let use the following code as example:</p>
<pre class="code bash literal-block">
<span class="nv">current_branch</span><span class="o">={{</span><span class="w"> </span>branch<span class="w"> </span><span class="o">}}</span><span class="w">
</span><span class="nv">current_version</span><span class="o">={{</span><span class="w"> </span>package_version<span class="w"> </span><span class="o">}}</span><span class="w">
</span><span class="nv">need_update</span><span class="o">={{</span><span class="w"> </span>update_available<span class="w"> </span><span class="o">}}</span>
</pre>
<p>where <tt class="docutils literal">branch</tt> is <tt class="docutils literal">main</tt>, <tt class="docutils literal">package_version</tt> is <tt class="docutils literal">0.12</tt> and
<tt class="docutils literal">update_available</tt> is <tt class="docutils literal">False</tt></p>
<div class="section" id="generic-mode">
<h4>Generic Mode</h4>
<p>Default mode which renders variable values “as is”. It is done in order
to keep compatibility with any code interpreter which may be used to run
a command. The code from example will be rendered the following way:</p>
<pre class="code bash literal-block">
<span class="nv">current_branch</span><span class="o">=</span>main<span class="w">
</span><span class="nv">current_version</span><span class="o">=</span><span class="m">0</span>.12<span class="w">
</span><span class="nv">need_update</span><span class="o">=</span>False
</pre>
</div>
<div class="section" id="pythonic-mode">
<h4>Pythonic Mode</h4>
<p>This mode is used in <a class="reference external" href="#configure-a-command">commands</a> that run Python
code (<tt class="docutils literal">Action: Execute Python code</tt>). In this mode all variable values
except Boolean and None are enclosed in double quotes. The code from
example will be rendered the following way:</p>
<pre class="code python literal-block">
<span class="n">current_branch</span><span class="o">=</span><span class="s2">&quot;main&quot;</span><span class="w">
</span><span class="n">current_version</span><span class="o">=</span><span class="s2">&quot;0.12&quot;</span><span class="w">
</span><span class="n">need_update</span><span class="o">=</span><span class="kc">False</span>
</pre>
</div>
</div>
<div class="section" id="variable-types">
<h3>Variable Types</h3>
<p>Following types of variable values available in <a class="reference external" href="https://cetmix.com/tower">Cetmix
Tower</a>:</p>
<ul class="simple">
<li>Local values. Those are values that are defined at a record level.
For example for a server or an action.</li>
<li>Global values. Those are values that are defined at the <a class="reference external" href="https://cetmix.com/tower">Cetmix
Tower</a> level.</li>
</ul>
<p>When rendering an expression local values are used first. If no local
value is found then global value will be used. For example default value
of the <tt class="docutils literal">odoo_port</tt> variable is <tt class="docutils literal">8069</tt>. However you can easily
specify any other value and thus run multiple Odoo instances on a single
server.</p>
<p><strong>IMPORTANT!</strong>: Storing sensitive data (eg GitHub tokens) in variable
values may expose that date in command preview and logs. Use
<a class="reference external" href="#configure-a-keysecret">secrets</a> for storing such data instead.</p>
</div>
<div class="section" id="tower-system-variable">
<h3>‘tower’ System Variable</h3>
<p>There is a special <tt class="docutils literal">tower</tt> variable available which allows to access
some system parameters and helper tools. <strong>Important!</strong> do not redefine
the <tt class="docutils literal">tower</tt> variable unless you really need that on purpose.</p>
<p>Following system variables are available:</p>
<ul class="simple">
<li>Server properties<ul>
<li><tt class="docutils literal">tower.server.name</tt> Current server&nbsp;name</li>
<li><tt class="docutils literal">tower.server.reference</tt> Current server&nbsp;reference</li>
<li><tt class="docutils literal">tower.server.username</tt> Current server&nbsp;SSH Username​</li>
<li><tt class="docutils literal">tower.server.ipv4</tt> Current server&nbsp;IPv4 Address​</li>
<li><tt class="docutils literal">tower.server.ipv6</tt> Current server&nbsp;IPv6 Address​</li>
<li><tt class="docutils literal">tower.server.partner_name</tt> Current server partner name</li>
</ul>
</li>
<li>Helper tools<ul>
<li><tt class="docutils literal">tower.tools.uuid</tt> Generates a random UUID4</li>
<li><tt class="docutils literal">tower.tools.today</tt> Current date</li>
<li><tt class="docutils literal">tower.tools.now</tt> Current date time</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="configure-a-key-secret">
<h2>Configure a Key/Secret</h2>
<p>Keys/Secrets are used to private SSH keys and sensitive data that is
used for rendering commands. To configure a new key or secret go to
<tt class="docutils literal">Cetmix Tower/Settings/Keys</tt> click <tt class="docutils literal">Create</tt> and put values in the
fields:</p>
<ul class="simple">
<li><strong>Name</strong>: Readable name</li>
<li><strong>Key Type</strong>: Following values are available:<ul>
<li><tt class="docutils literal">SSH Key</tt> is used to store SSH private keys. They are selectable
in <a class="reference external" href="#configure-a-server">Server settings</a></li>
<li><tt class="docutils literal">Secret</tt> used to store sensitive information that can be used
inline in commands. Eg a token or a password. Secrets cannot be
previewed in command preview and are replaced with placeholder in
<a class="reference external" href="#configure-a-command">command</a> logs.</li>
</ul>
</li>
<li><strong>Reference</strong>: Key/secret record reference</li>
<li><strong>Reference Code</strong>: Complete reference code for inline usage</li>
<li><strong>Value</strong>: Key value. <strong>IMPORTANT:</strong> This is a write only field.
Please ensure that you have saved your key/secret before saving it.
Once saved it cannot be read from the user interface any longer.</li>
<li><strong>Used For</strong>: <tt class="docutils literal">SSH Key</tt> type only. List of
<a class="reference external" href="#configure-a-server">Servers</a> where this SSH key is used</li>
<li><strong>Partner</strong>: <tt class="docutils literal">Secret</tt> type only. If selected this secret is used
only for the <a class="reference external" href="#configure-a-server">Servers</a> of selected partner</li>
<li><strong>Server</strong>: <tt class="docutils literal">Secret</tt> type only. If selected this secret is used
only for selected <a class="reference external" href="#configure-a-server">Server</a></li>
<li><strong>Note</strong>: Put your notes here</li>
</ul>
<div class="section" id="keys-of-type-secret">
<h3>Keys of type <tt class="docutils literal">Secret</tt></h3>
<p>Keys of type <tt class="docutils literal">Secret</tt> (or “Secret”) are considered “Global” if no
partner and no server are selected. Such keys are accessible all across
the Tower. Global keys are overridden with partner keys with the same
reference. Partner keys in their turn are overridden with server
specific keys. Priority order from highest to lowest is:</p>
<ol class="arabic simple">
<li>Server specific</li>
<li>Partner specific</li>
<li>Global</li>
</ol>
<p>Secrets are inserted inline in code using the following pattern:
<tt class="docutils literal">#!cxtower.secret.REFERENCE!#</tt>. It consists of three dot separated
parts and is terminated with a mandatory <tt class="docutils literal">!#</tt> suffix:</p>
<ul class="simple">
<li><tt class="docutils literal">#!cxtower</tt> is used to declare a special Tower construction</li>
<li><tt class="docutils literal">secret</tt> is used to declare its type (secret)</li>
<li><tt class="docutils literal">REFERENCE</tt> secret id as it’s written in the <strong>Key ID</strong> field</li>
</ul>
<p><strong>Example:</strong></p>
<p>Suppose we have a secret with <strong>Key ID</strong> set to <tt class="docutils literal">MY_SECRET_DIR</tt> and
value <tt class="docutils literal">suchMuchFolder</tt>. In this case the following command:</p>
<pre class="code bash literal-block">
mkdir<span class="w"> </span>/home/#!cxtower.secret.MY_SECRET_DIR!#
</pre>
<p>will be executed as:</p>
<pre class="code bash literal-block">
mkdir<span class="w"> </span>/home/suchMuchFolder
</pre>
</div>
</div>
<div class="section" id="configure-a-file">
<h2>Configure a File</h2>
<p><a class="reference external" href="https://cetmix.com/tower">Cetmix Tower</a> is using SFTP protocol for
file transfer operations. Based on initial file location following file
sources are available:</p>
<ul class="simple">
<li>Server. These are files that are initially located on remote server
and are fetched to <a class="reference external" href="https://cetmix.com/tower">Cetmix Tower</a>. For
example log files.</li>
<li>Tower. These are files that are initially formed in <a class="reference external" href="https://cetmix.com/tower">Cetmix
Tower</a> and are uploaded to remote
server. For example configuration files. Such files are rendered
using variables and can be created and managed using file templates.</li>
</ul>
<p>To create a new file go to <tt class="docutils literal">Cetmix Tower/Files/Files</tt> click <tt class="docutils literal">Create</tt>
and put values in the fields:</p>
<ul class="simple">
<li><strong>Name</strong>: Filesystem filename</li>
<li><strong>Source</strong>: File source. Available options are <tt class="docutils literal">Server</tt> and
<tt class="docutils literal">Tower</tt>. Check above for more details.</li>
<li><strong>File type</strong>: Type of file contents. Possible options:<ul>
<li><strong>Text</strong>: Regular text. Eg configuration file or log</li>
<li><strong>Binary</strong>: Binary file. Eg file archive or pdf document</li>
</ul>
</li>
<li><strong>File</strong>: Is used to store binary file data.</li>
<li><strong>Template</strong>: File template used to render this file. If selected
file will be automatically updated every time template is modified.</li>
<li><strong>Server</strong>: Server where this file is located</li>
<li><strong>Directory on Server</strong>: This is where the file is located on the
remote server</li>
<li><strong>Full Server Path</strong>: Full path to file on the remote server
including filename</li>
<li><strong>Auto Sync</strong>: If enabled the file will be automatically uploaded to
the remote server on after it is modified in <a class="reference external" href="https://cetmix.com/tower">Cetmix
Tower</a>. Used only with <tt class="docutils literal">Tower</tt> source.</li>
<li><strong>Keep when deleted</strong>: If enabled, file will be kept on remote server
after removing it in the Odoo</li>
</ul>
<p>Following fields are located in the tabs below:</p>
<ul class="simple">
<li><strong>Code</strong>: Raw file content. This field is editable for the <tt class="docutils literal">Tower</tt>
files and readonly for <tt class="docutils literal">Server</tt> ones. This field supports
<a class="reference external" href="#configure-variables">Variables</a>.</li>
<li><strong>Preview</strong>: This is a rendered file content as it will be uploaded
to server. Used only with <tt class="docutils literal">Tower</tt> source.</li>
<li><strong>Server Version</strong>: Current file content fetched from server. Used
only with <tt class="docutils literal">Tower</tt> source.</li>
</ul>
<p><strong>NB</strong>: File operations are performed using user credentials from server
configuration. You should take care of filesystem access rights to
ensure that file operations are performed without any issues.</p>
<div class="section" id="file-templates">
<h3>File Templates</h3>
<p>File templates are used to create and manage multiple files in bulk.
Once a template is modified all related files are automatically updated.</p>
<p>To create a new file template go to <tt class="docutils literal">Cetmix Tower/Files/Templates</tt>
click <tt class="docutils literal">Create</tt> and put values in the fields:</p>
<ul class="simple">
<li><strong>Name</strong>: Template name</li>
<li><strong>Reference</strong>: Leave the “reference” field blank to generate a
reference automatically.</li>
<li><strong>File Name</strong>: Filesystem name of the file(s) created from this
template. This field supports <a class="reference external" href="#configure-variables">Variables</a>.</li>
<li><strong>Directory on server</strong>: Directory on remote server where this file
will be stored. This field supports
<a class="reference external" href="#configure-variables">Variables</a>.</li>
<li><strong>Source</strong>: File source. Available options are <tt class="docutils literal">Server</tt> and
<tt class="docutils literal">Tower</tt>. Check above for more details.</li>
<li><strong>File type</strong>: Type of file contents. Possible options:<ul>
<li><strong>Text</strong>: Regular text. Eg configuration file or log</li>
<li><strong>Binary</strong>: Binary file. Eg file archive or pdf document</li>
</ul>
</li>
<li><strong>Tags</strong>: Make usage as search more convenient</li>
<li><strong>Note</strong>: Comments or user notes</li>
<li><strong>Code</strong>: Raw file content. This field supports
<a class="reference external" href="#configure-variables">Variables</a>.</li>
<li><strong>Keep when deleted</strong>: If enabled, file(s) created from this template
will be kept on remote server after removing it(them) in the Odoo</li>
</ul>
<p><strong>Hint</strong>: If you want to create a file from template but don’t want
further template modifications to be applied to this file remove the
value from the <tt class="docutils literal">Template</tt> field before saving it.</p>
</div>
</div>
<div class="section" id="configure-a-command">
<h2>Configure a Command</h2>
<p>Command is a shell command that is executed on remote server. To create
a new command go to <tt class="docutils literal">Cetmix Tower/Commands/Commands</tt> click <tt class="docutils literal">Create</tt>
and put values in the fields:</p>
<ul class="simple">
<li><strong>Name</strong>: Command readable name.</li>
<li><strong>Reference</strong>: Leave the “reference” field blank to generate a
reference automatically.</li>
<li><strong>Allow Parallel Run</strong>: If disabled only one copy of this command can
be run on the same server at the same time. Otherwise the same
command can be run in parallel.</li>
<li><strong>Note</strong>: Comments or user notes.</li>
<li><strong>Servers</strong>: List of servers this command can be run on. Leave this
field blank to make the command available to all servers.</li>
<li><strong>OSes</strong>: List of operating systems this command is available. Leave
this field blank to make the command available for all OSes.</li>
<li><strong>Tags</strong>: Make usage as search more convenient.</li>
<li><strong>Action</strong>: Action executed by the command. Possible options:<ul>
<li><tt class="docutils literal">SSH command</tt>: Execute a shell command using ssh connection on
remote server.</li>
<li><tt class="docutils literal">Execute Python code</tt>: Execute a Python code on the Tower
Server.</li>
<li><tt class="docutils literal">Create file using template</tt>: Create or update a file using
selected file template and push / pull it to remote server /
tower. If the file already exists on server it will be
overwritten.</li>
</ul>
</li>
<li><strong>Default Path</strong>: Specify path where command will be executed. This
field supports <a class="reference external" href="#configure-variables">Variables</a>. Important:
ensure ssh user has access to the location even if executing command
using sudo.</li>
<li><strong>Code</strong>: Code to execute. Can be an SSH command or Python code based
on selected action. This field supports
<a class="reference external" href="#configure-variables">Variables</a>. <strong>Important!</strong> Variables used
in command are rendered in <a class="reference external" href="#variable-rendering-modes">different
modes</a> based on the command action.</li>
<li><strong>File Template</strong>: File template that will be used to create or
update file. Check <a class="reference external" href="#file-templates">File Templates</a> for more
details.</li>
</ul>
<p>To return result from Python assign exit code and message to the
COMMAND_RESULT variable of type <tt class="docutils literal">dict</tt> like this:</p>
<pre class="code python literal-block">
<span class="c1"># Success</span><span class="w">
</span><span class="n">COMMAND_RESULT</span> <span class="o">=</span> <span class="p">{</span><span class="w">
</span>    <span class="s2">&quot;exit_code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span><span class="w">
</span>    <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;This will be logged as a result message because exit code == 0&quot;</span><span class="p">,</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># Error</span><span class="w">
</span><span class="n">COMMAND_RESULT</span> <span class="o">=</span> <span class="p">{</span><span class="w">
</span>    <span class="s2">&quot;exit_code&quot;</span><span class="p">:</span> <span class="mi">21</span><span class="p">,</span><span class="w">
</span>    <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;This will be logged as an error message because exit code != 0&quot;</span><span class="p">,</span><span class="w">
</span><span class="p">}</span>
</pre>
</div>
<div class="section" id="configure-a-flight-plan">
<h2>Configure a Flight Plan</h2>
<p>Flight Plans are used to execute commands in series. They allow to build
a flexible condition based execution flow. To create a new flight plan
go to <tt class="docutils literal">Cetmix Tower/Commands/Flight Plans</tt> click <tt class="docutils literal">Create</tt> and put
values in the fields:</p>
<ul>
<li><p class="first"><strong>Name</strong>: Flight Plan name</p>
</li>
<li><p class="first"><strong>Reference</strong>: Leave the “reference” field blank to generate a
reference automatically.</p>
</li>
<li><p class="first"><strong>On Error</strong>: Default action to execute when an error happens during
the flight plan execution. Possible options:</p>
<ul class="simple">
<li><tt class="docutils literal">Exit with command code</tt>. Will terminate the flight plan
execution and return an exit code of the failed command.</li>
<li><tt class="docutils literal">Exit with custom code</tt>. Will terminate the flight plan
execution and return the custom code configured in the field next
to this one.</li>
<li><tt class="docutils literal">Run next command</tt>. Will continue flight plan execution.</li>
</ul>
</li>
<li><p class="first"><strong>Note</strong>: Comments or user notes.</p>
</li>
<li><p class="first"><strong>Servers</strong>: List of servers this command can be run on. Leave this
field blank to make the command available to all servers.</p>
</li>
<li><p class="first"><strong>Tags</strong>: Make usage as search more convenient.</p>
</li>
<li><p class="first"><strong>Code</strong>: List of commands to execute. Each of the commands has the
following fields:</p>
<ul class="simple">
<li><strong>Sequence</strong>: Order this command is executed. Lower value = higher
priority.</li>
<li><strong>Condition</strong>: <a class="reference external" href="https://www.w3schools.com/python/python_syntax.asp">Python
expression</a>
to be matched for the command to be executed. Leave this field
blank for unconditional command execution. This field supports
<a class="reference external" href="#configure-variables">Variables</a>. Example:</li>
</ul>
<pre class="code python literal-block">
<span class="p">{{</span> <span class="n">odoo_version</span> <span class="p">}}</span> <span class="o">==</span> <span class="s2">&quot;17.0&quot;</span> <span class="ow">and</span> <span class="p">(</span> <span class="p">{{</span> <span class="n">nginx_installed</span> <span class="p">}}</span> <span class="ow">or</span> <span class="p">{{</span> <span class="n">traefik_installed</span> <span class="p">}}</span> <span class="p">)</span>
</pre>
<ul class="simple">
<li><strong>Command</strong>: <a class="reference external" href="#configure-a-command">Command</a> to be executed.</li>
<li><strong>Path</strong>: Specify path where command will be executed. Overrides
<tt class="docutils literal">Default Path</tt> of the command. This field supports
<a class="reference external" href="#configure-variables">Variables</a>.</li>
<li><strong>Use Sudo</strong>: Use <tt class="docutils literal">sudo</tt> if required to run this command.</li>
<li><strong>Post Run Actions</strong>: List of conditional actions to be triggered
after the command is executed. Each of the actions has the
following fields:<ul>
<li><strong>Sequence</strong>: Order this actions is triggered. Lower value =
higher priority.</li>
<li><strong>Condition</strong>: Uses command exit code.</li>
<li><strong>Action</strong>: Action to execute if condition is met. Also, if
variables with values are specified, these variables will be
updated (for existing variables on the server) or added (for
new variables) to the server variables. Possible options:<ul>
<li><tt class="docutils literal">Exit with command code</tt>. Will terminate the flight plan
execution and return an exit code of the failed command.</li>
<li><tt class="docutils literal">Exit with custom code</tt>. Will terminate the flight plan
execution and return the custom code configured in the field
next to this one.</li>
<li><tt class="docutils literal">Run next command</tt>. Will continue flight plan execution.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="configure-a-server-log">
<h2>Configure a Server Log</h2>
<p>Server Logs allow to fetch and view logs of a server fast and convenient
way. To configure a Server Log open the server form, navigate to the
<tt class="docutils literal">Server Logs</tt> tab and add a new record in the list.</p>
<p><img alt="Server logs tab" src="https://raw.githubusercontent.com/cetmix/cetmix-tower/14.0-dev/cetmix_tower_server/static/description/images/server_log_tab.png" /></p>
<p>Following fields are available:</p>
<ul class="simple">
<li><strong>Name</strong>: Readable name of the log</li>
<li><strong>Access Level</strong>: Minimum access level required to access this
record. Please check the <a class="reference external" href="#user-access-configuration">User Access
Settings</a> section for more details.
Possible options:<ul>
<li><tt class="docutils literal">User</tt>. User must have at least <tt class="docutils literal">Cetmix Tower / User</tt> access
group configured in the User Settings.</li>
<li><tt class="docutils literal">Manager</tt>. User must have at least <tt class="docutils literal">Cetmix Tower / Manager</tt>
access group configured in the User Settings.</li>
<li><tt class="docutils literal">Root</tt>. User must have <tt class="docutils literal">Cetmix Tower / Root</tt> access group
configured in the User Settings.</li>
</ul>
</li>
<li><strong>Log Type</strong>: Defines the way logs are fetched. Possible options:<ul>
<li><tt class="docutils literal">Command</tt>. A command is run with its output being saved to the
log</li>
<li><tt class="docutils literal">File</tt>. Log is fetched from a file</li>
</ul>
</li>
<li><strong>Command</strong>: A command that is used to fetched the logs. This option
is available only for <tt class="docutils literal">Log Type</tt> set to <tt class="docutils literal">Command</tt>. Important:
please ensure that selected command can be executed multiple times in
parallel to avoid any potential issues.</li>
<li><strong>Use Sudo</strong>: Use <tt class="docutils literal">sudo</tt> if required to run this command.</li>
<li><strong>File</strong>: A file that is used to fetch the log. This option is not
available when configuring a log for a <a class="reference external" href="#configure-a-server-template">Server
Template</a></li>
<li><strong>File Template</strong>: A file template that is used to create a file when
a new <a class="reference external" href="#configure-a-server">Server</a> is created from a <a class="reference external" href="#configure-a-server-template">Server
Template</a>. This option is available
only when configuring a log for a <a class="reference external" href="#configure-a-server-template">Server
Template</a></li>
</ul>
<p><strong>Developer hint</strong>: log output supports HTML formatting. You can
implement your custom log formatter by overriding the
<tt class="docutils literal">_format_log_text()</tt> function of the <tt class="docutils literal">cx.tower.server.log</tt> model.</p>
</div>
<div class="section" id="configuration-best-practices">
<h2>Configuration best practices</h2>
<div class="section" id="use-simple-commands">
<h3>Use simple commands</h3>
<p>Try to avoid using <tt class="docutils literal">&amp;&amp;</tt> or <tt class="docutils literal">;</tt> joined commands unless this is really
needed. Use flight plans instead.</p>
<p><strong>Why?</strong></p>
<ul class="simple">
<li>Simple commands are easier to reuse across multiple flight plans.</li>
<li>Commands run with <tt class="docutils literal">sudo</tt> with password are be split and executed
one by one anyway.</li>
</ul>
<p><strong>Not recommended:</strong></p>
<pre class="code bash literal-block">
apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt-get<span class="w"> </span>upgrade<span class="w"> </span>-y<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>doge-meme-generator
</pre>
<p><strong>Way to go:</strong></p>
<pre class="code bash literal-block">
apt-get<span class="w"> </span>update
</pre>
<pre class="code bash literal-block">
apt-get<span class="w"> </span>upgrade<span class="w"> </span>-y
</pre>
<pre class="code bash literal-block">
apt-get<span class="w"> </span>install<span class="w"> </span>doge-meme-generator
</pre>
</div>
<div class="section" id="do-not-change-directory-using-shell-commands">
<h3>Do not change directory using shell commands</h3>
<p>Do not use <tt class="docutils literal">cd</tt> or <tt class="docutils literal">chdir</tt> commands. Use <tt class="docutils literal">Default Path</tt> field in
command or <tt class="docutils literal">Path</tt> field in flight plan line.</p>
<p><strong>Why?</strong></p>
<ul class="simple">
<li>Tower will automatically adjust the command to ensure it is properly
executed in the specified location.</li>
</ul>
<p><strong>Do not do this:</strong></p>
<pre class="code bash literal-block">
<span class="nb">cd</span><span class="w"> </span>/home/<span class="o">{{</span><span class="w"> </span>tower.server.username<span class="w"> </span><span class="o">}}</span>/memes<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>cat<span class="w"> </span>my_doge_memes.txt
</pre>
<p><strong>Way to go:</strong></p>
<ul class="simple">
<li>Add the following value in the <tt class="docutils literal">Default Path</tt> command field or
<tt class="docutils literal">Path</tt> field of a flight plan line:</li>
</ul>
<pre class="code bash literal-block">
/home/<span class="o">{{</span><span class="w"> </span>tower.server.username<span class="w"> </span><span class="o">}}</span>/memes
</pre>
<ul class="simple">
<li>Leave the command code as follows:</li>
</ul>
<pre class="code bash literal-block">
cat<span class="w"> </span>my_doge_memes.txt
</pre>
</div>
</div>
</div>
<div class="section" id="usage">
<h1>Usage</h1>
<div class="section" id="create-a-new-server-from-a-server-template">
<h2>Create a new Server from a Server Template</h2>
<ul class="simple">
<li>Go to the <tt class="docutils literal">Cetmix Tower/Servers/Templates</tt> menu and select a
<a class="reference external" href="CONFIGURE.md/#configure-a-server-template">Server Template</a></li>
<li>Click “Create Server” button. A pop-up wizard will open with server
parameters populated from the template</li>
<li>Put the new server name, check the parameters and click “Confirm”
button</li>
<li>New server will be created</li>
<li>If a <a class="reference external" href="CONFIGURE.md/#configure-a-flight-plan">Flight Plan</a> is
defined in the server template it will be automatically executed
after a new server is created</li>
</ul>
<p>You can also create a new server from template from code using a
designated <tt class="docutils literal">create_server_from_template</tt> function of the
<tt class="docutils literal">cx.tower.server.template</tt> model. This function takes the following
arguments:</p>
<pre class="code python literal-block">
<span class="o">-</span> <span class="n">template_reference</span> <span class="p">(</span><span class="n">Char</span><span class="p">):</span> <span class="n">Server</span> <span class="n">template</span> <span class="n">reference</span><span class="w">
</span><span class="o">-</span> <span class="n">server_name</span> <span class="p">(</span><span class="n">Char</span><span class="p">):</span> <span class="n">Name</span> <span class="n">of</span> <span class="n">the</span> <span class="n">new</span> <span class="n">server</span><span class="w">
</span><span class="o">-</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span><span class="w">
</span>  <span class="o">-</span> <span class="n">partner</span> <span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">partner</span><span class="p">(),</span> <span class="n">optional</span><span class="p">):</span> <span class="n">Partner</span> <span class="n">this</span> <span class="n">server</span> <span class="n">belongs</span> <span class="n">to</span><span class="o">.</span><span class="w">
</span>  <span class="o">-</span> <span class="n">ipv4</span> <span class="p">(</span><span class="n">Char</span><span class="p">,</span> <span class="n">optional</span><span class="p">):</span> <span class="n">IP</span> <span class="n">v4</span> <span class="n">address</span><span class="o">.</span> <span class="n">Defaults</span> <span class="n">to</span> <span class="kc">None</span><span class="o">.</span><span class="w">
</span>  <span class="o">-</span> <span class="n">ipv6</span> <span class="p">(</span><span class="n">Char</span><span class="p">,</span> <span class="n">optional</span><span class="p">):</span> <span class="n">IP</span> <span class="n">v6</span> <span class="n">address</span><span class="o">.</span> <span class="n">Must</span> <span class="n">be</span> <span class="n">provided</span> <span class="ow">in</span> <span class="n">case</span> <span class="n">IP</span> <span class="n">v4</span> <span class="ow">is</span> <span class="ow">not</span><span class="o">.</span> <span class="n">Defaults</span> <span class="n">to</span> <span class="kc">None</span><span class="o">.</span><span class="w">
</span>  <span class="o">-</span> <span class="n">ssh_password</span> <span class="p">(</span><span class="n">Char</span><span class="p">,</span> <span class="n">optional</span><span class="p">):</span> <span class="n">SSH</span> <span class="n">password</span><span class="o">.</span> <span class="n">Defaults</span> <span class="n">to</span> <span class="kc">None</span><span class="o">.</span> <span class="n">Defaults</span> <span class="n">to</span> <span class="kc">None</span><span class="o">.</span><span class="w">
</span>  <span class="o">-</span> <span class="n">ssh_private_key_value</span> <span class="p">(</span><span class="n">Char</span><span class="p">,</span> <span class="n">optional</span><span class="p">):</span> <span class="n">SSH</span> <span class="n">private</span> <span class="n">key</span> <span class="n">content</span><span class="o">.</span><span class="w">
</span>  <span class="o">-</span> <span class="n">ssh_private_key_value</span> <span class="p">(</span><span class="n">cx</span><span class="o">.</span><span class="n">tower</span><span class="o">.</span><span class="n">key</span><span class="p">(),</span> <span class="n">optional</span><span class="p">):</span> <span class="n">SSH</span> <span class="n">private</span> <span class="n">key</span> <span class="n">record</span><span class="o">.</span> <span class="n">Defaults</span> <span class="n">to</span> <span class="kc">None</span><span class="o">.</span><span class="w">
</span>  <span class="o">-</span> <span class="n">configuration_variables</span> <span class="p">(</span><span class="n">Dict</span><span class="p">,</span> <span class="n">optional</span><span class="p">):</span> <span class="n">Custom</span> <span class="n">configuration</span> <span class="n">variable</span><span class="o">.</span><span class="w">
</span>    <span class="n">Following</span> <span class="nb">format</span> <span class="ow">is</span> <span class="n">used</span><span class="p">:</span><span class="w">
</span>      <span class="s1">'variable_reference'</span><span class="p">:</span> <span class="s1">'variable_value_char'</span><span class="w">
</span>      <span class="n">eg</span><span class="p">:</span><span class="w">
</span>      <span class="p">{</span><span class="s1">'branch'</span><span class="p">:</span> <span class="s1">'prod'</span><span class="p">,</span> <span class="s1">'odoo_version'</span><span class="p">:</span> <span class="s1">'16.0'</span><span class="p">}</span>
</pre>
<p>Here is a short example of an Odoo automated action that creates a new
server when a Sales Order is confirmed:</p>
<p><img alt="Automatic action" src="https://raw.githubusercontent.com/cetmix/cetmix-tower/14.0-dev/cetmix_tower_server/static/description/images/server_from_template_auto_action.png" /></p>
<pre class="code python literal-block">
<span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">records</span><span class="p">:</span><span class="w">

</span>  <span class="c1"># Check confirmed orders</span><span class="w">
</span>  <span class="k">if</span> <span class="n">record</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;sale&quot;</span><span class="p">:</span><span class="w">
</span>    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="w">
</span>      <span class="s2">&quot;ip_v4_address&quot;</span><span class="p">:</span> <span class="s2">&quot;host.docker.internal&quot;</span><span class="p">,</span><span class="w">
</span>      <span class="s2">&quot;ssh_port&quot;</span><span class="p">:</span> <span class="mi">2222</span><span class="p">,</span><span class="w">
</span>      <span class="s2">&quot;ssh_username&quot;</span><span class="p">:</span> <span class="s2">&quot;pepe&quot;</span><span class="p">,</span><span class="w">
</span>      <span class="s2">&quot;ssh_password&quot;</span><span class="p">:</span> <span class="s2">&quot;frog&quot;</span><span class="p">,</span><span class="w">
</span>      <span class="s2">&quot;ssh_auth_mode&quot;</span><span class="p">:</span> <span class="s2">&quot;p&quot;</span><span class="p">,</span><span class="w">
</span>      <span class="s2">&quot;configuration_variables&quot;</span><span class="p">:</span> <span class="p">{</span><span class="w">
</span>        <span class="s2">&quot;odoo_version&quot;</span><span class="p">:</span> <span class="s2">&quot;16.0&quot;</span><span class="w">
</span>        <span class="p">},</span><span class="w">
</span>    <span class="p">}</span><span class="w">

</span>    <span class="c1"># Create a new server from template with the 'demo_template' reference</span><span class="w">
</span>    <span class="n">env</span><span class="p">[</span><span class="s2">&quot;cetmix.tower&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">server_create_from_template</span><span class="p">(</span><span class="w">
</span>      <span class="n">template_reference</span><span class="o">=</span><span class="s2">&quot;demo_template&quot;</span><span class="p">,</span><span class="w">
</span>      <span class="n">server_name</span><span class="o">=</span><span class="n">record</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="w">
</span>      <span class="o">**</span><span class="n">params</span><span class="w">
</span>      <span class="p">)</span>
</pre>
</div>
<div class="section" id="run-a-command">
<h2>Run a Command</h2>
<ul class="simple">
<li>Select a server in the list view or open a server form view</li>
<li>Open the <tt class="docutils literal">Actions</tt> menu and click <tt class="docutils literal">Execute Command</tt></li>
<li>A wizard is opened with the following fields:<ul>
<li><strong>Servers</strong>: Servers on which this command will be executed</li>
<li><strong>Tags</strong>: If selected only commands with these tags will be shown</li>
<li><strong>Sudo</strong>: <tt class="docutils literal">sudo</tt> option for running this command</li>
<li><strong>Command</strong>: Command to execute</li>
<li><strong>Show shared</strong>: By default only commands available for the
selected server(s) are selectable. Activate this checkbox to
select any command</li>
<li><strong>Path</strong>: Directory where command will be executed. Important:
this field does not support variables! Ensure that user has access
to this location even if you run command using sudo.</li>
<li><strong>Code</strong>: Raw command code</li>
<li><strong>Preview</strong>: Command code rendered using server variables.
<strong>IMPORTANT:</strong> If several servers are selected preview will be
rendered for the first one. However during the command execution
command code will be rendered for each server separately.</li>
</ul>
</li>
</ul>
<p>There are two action buttons available in the wizard:</p>
<ul class="simple">
<li><strong>Run</strong>. Executes a command using server “run” method and log command
result into the “Command Log”.</li>
<li><strong>Run in wizard</strong>. Executes a command directly in the wizard and show
command log in a new wizard window.</li>
</ul>
<p>You can check command execution logs in the
<tt class="docutils literal">Cetmix Tower/Commands/Command Logs</tt> menu. Important! If you want to
delete a command you need to delete all its logs manually before doing
that.</p>
</div>
<div class="section" id="run-a-flight-plan">
<h2>Run a Flight Plan</h2>
<ul>
<li><p class="first">Select a server in the list view or open a server form view</p>
</li>
<li><p class="first">Open the <tt class="docutils literal">Actions</tt> menu and click <tt class="docutils literal">Execute Flight Plan</tt></p>
</li>
<li><p class="first">A wizard is opened with the following fields:</p>
<ul class="simple">
<li><strong>Servers</strong>: Servers on which this command will be executed</li>
<li><strong>Tags</strong>: If selected only commands with these tags will be shown</li>
<li><strong>Plan</strong>: Flight plan to execute</li>
<li><strong>Show shared</strong>: By default only flight plans available for the
selected server(s) are selectable. Activate this checkbox to
select any flight plan</li>
<li><strong>Commands</strong>: Commands that will be executed in this flight plan.
This field is read only</li>
</ul>
<p>Click the <strong>Run</strong> button to execute a flight plan.</p>
<p>You can check the flight plan results in the
<tt class="docutils literal">Cetmix Tower/Commands/Flight Plan Logs</tt> menu. Important! If you
want to delete a command you need to delete all its logs manually
before doing that.</p>
</li>
</ul>
</div>
<div class="section" id="check-a-server-log">
<h2>Check a Server Log</h2>
<p>To check a server log:</p>
<ul class="simple">
<li>Navigate to the <tt class="docutils literal">Server Logs</tt> tab on the Server form</li>
<li>Click on the log <strong>(1)</strong> you would like to check to open in in a pop
up window. Or click on the <tt class="docutils literal">Open</tt> button <strong>(2)</strong> to open it in the
full form view</li>
</ul>
<p><img alt="Open server log" src="https://raw.githubusercontent.com/cetmix/cetmix-tower/14.0-dev/cetmix_tower_server/static/description/images/server_log_usage_1.png" /></p>
<ul class="simple">
<li>Click the <tt class="docutils literal">Refresh</tt> button to update the log. You can also click
the <tt class="docutils literal">Refresh All</tt> button <strong>(3)</strong> located above the log list in
order to refresh all logs at once. Log output will be displayed in
the HTML field below.</li>
</ul>
<p><img alt="Update server log" src="https://raw.githubusercontent.com/cetmix/cetmix-tower/14.0-dev/cetmix_tower_server/static/description/images/server_log_usage_2.png" /></p>
</div>
<div class="section" id="using-cetmix-tower-in-odoo-automation">
<h2>Using Cetmix Tower in Odoo automation</h2>
<p>You can use various Cetmix Tower functions in Odoo automation. Such as
server actions, automated actions or scheduled actions. While you can
always call any public function directly most useful helper functions
are located in a special abstract model “cetmix.tower”. You can check
those functions in the source code in the following file:
<tt class="docutils literal">models/cetmix_tower.py</tt></p>
</div>
</div>
<div class="section" id="bug-tracker">
<h1>Bug Tracker</h1>
<p>Bugs are tracked on <a class="reference external" href="https://github.com/cetmix/cetmix-tower/issues">GitHub Issues</a>.
In case of trouble, please check there if your issue has already been reported.
If you spotted it first, help us to smash it by providing a detailed and welcomed
<a class="reference external" href="https://github.com/cetmix/cetmix-tower/issues/new?body=module:%20cetmix_tower_server%0Aversion:%2014.0-dev%0A%0A**Steps%20to%20reproduce**%0A-%20...%0A%0A**Current%20behavior**%0A%0A**Expected%20behavior**">feedback</a>.</p>
<p>Do not contact contributors directly about support or help with technical issues.</p>
</div>
<div class="section" id="credits">
<h1>Credits</h1>
<div class="section" id="authors">
<h2>Authors</h2>
<ul class="simple">
<li>Cetmix</li>
</ul>
</div>
<div class="section" id="maintainers">
<h2>Maintainers</h2>
<p>This module is part of the <a class="reference external" href="https://github.com/cetmix/cetmix-tower/tree/14.0-dev/cetmix_tower_server">cetmix/cetmix-tower</a> project on GitHub.</p>
<p>You are welcome to contribute.</p>
</div>
</div>
</div>
</body>
</html>
