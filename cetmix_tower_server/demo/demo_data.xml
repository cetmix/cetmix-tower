<?xml version="1.0" encoding="utf-8" ?>
<odoo noupdate="1">

    <!-- Add demo users to groups  -->
    <record id="base.user_admin" model="res.users">
        <field name="groups_id" eval="[(4, ref('cetmix_tower_server.group_root'))]" />
    </record>
    <record id="base.user_demo" model="res.users">
        <field name="groups_id" eval="[(4, ref('cetmix_tower_server.group_user'))]" />
    </record>

    <!-- OSs -->
    <record id="os_debian_10" model="cx.tower.os">
        <field name="name">Debian 10</field>
    </record>
    <record id="os_ubuntu_20_04" model="cx.tower.os">
        <field name="name">Ubuntu 20.04</field>
    </record>

    <!-- Tags -->
    <record id="tag_staging" model="cx.tower.tag">
        <field name="name">Staging</field>
        <field name="color">1</field>
    </record>
    <record id="tag_production" model="cx.tower.tag">
        <field name="name">Production</field>
        <field name="color">2</field>
    </record>
    <record id="tag_custom" model="cx.tower.tag">
        <field name="name">Custom</field>
        <field name="color">3</field>
    </record>

    <!-- Keys -->
    <record id="key_1" model="cx.tower.key">
        <field name="name">Key 1 SSH</field>
        <field name="key_type">k</field>
    </record>
    <record id="key_2" model="cx.tower.key">
        <field name="name">Key 2 Secret</field>
        <field name="key_type">s</field>
    </record>

    <!-- Servers -->
    <record id="server_test_1" model="cx.tower.server">
        <field name="name">Test Server #1</field>
        <field name="color">1</field>
        <field name="ip_v4_address">localhost</field>
        <field name="ssh_username">admin</field>
        <field name="ssh_password">password</field>
        <field name="ssh_auth_mode">p</field>
        <field name="ssh_key_id" ref="key_1" />
        <field name="os_id" ref="os_debian_10" />
        <field
            name="tag_ids"
            eval="[(6, 0, [ref('cetmix_tower_server.tag_custom')])]"
        />
        <field name="note">
            This server is used in unit tests.
            No variables are defined.
        </field>
    </record>
    <record id="server_test_2" model="cx.tower.server">
        <field name="color">2</field>
        <field name="name">Test Server #2</field>
        <field name="ip_v4_address">localhost</field>
        <field name="ssh_username">admin</field>
        <field name="ssh_password">password</field>
        <field name="ssh_auth_mode">k</field>
        <field name="use_sudo">p</field>
        <field name="ssh_key_id" ref="key_1" />
        <field name="os_id" ref="os_ubuntu_20_04" />
        <field
            name="tag_ids"
            eval="[(6, 0, [ref('cetmix_tower_server.tag_production')])]"
        />
        <field name="note">This server has variables configured</field>
    </record>

    <!-- Variables -->
    <record id="variable_path" model="cx.tower.variable">
        <field name="name">test_path</field>
    </record>
    <record id="variable_dir" model="cx.tower.variable">
        <field name="name">dir</field>
    </record>
    <record id="variable_os" model="cx.tower.variable">
        <field name="name">os</field>
    </record>
    <record id="variable_url" model="cx.tower.variable">
        <field name="name">url</field>
    </record>
    <record id="variable_version" model="cx.tower.variable">
        <field name="name">version</field>
    </record>
    <record id="variable_org" model="cx.tower.variable">
        <field name="name">org</field>
    </record>
    <record id="variable_branch" model="cx.tower.variable">
        <field name="name">branch</field>
    </record>

    <!-- Variable values -->
    <record id="server_2_value_path" model="cx.tower.variable.value">
        <field name="variable_id" ref="variable_path" />
        <field name="server_id" ref="server_test_2" />
        <field name="value_char">/opt/cetmix-tower</field>
    </record>
    <record id="server_2_value_url" model="cx.tower.variable.value">
        <field name="variable_id" ref="variable_url" />
        <field name="server_id" ref="server_test_2" />
        <field name="value_char">https://cetmix.com</field>
    </record>
    <record id="server_2_value_branch" model="cx.tower.variable.value">
        <field name="variable_id" ref="variable_branch" />
        <field name="server_id" ref="server_test_2" />
        <field name="value_char">staging</field>
    </record>
    <record id="global_value_branch" model="cx.tower.variable.value">
        <field name="variable_id" ref="variable_branch" />
        <field name="value_char">prod</field>
    </record>
    <record id="global_value_org" model="cx.tower.variable.value">
        <field name="variable_id" ref="variable_org" />
        <field name="value_char">Cetmix</field>
    </record>

    <!-- Commands -->
    <record id="command_create_dir" model="cx.tower.command">
        <field name="name">Create directory</field>
        <field name="code">cd {{ test_path }} &amp;&amp; mkdir {{ dir }}</field>
    </record>
    <record id="command_list_dir" model="cx.tower.command">
        <field name="name">List files in directory</field>
        <field name="code">cd {{ test_path }} &amp;&amp; ls -l</field>
    </record>

    <!-- Flight Plans -->
    <record id="plan_test_1" model="cx.tower.plan">
        <field name="name">Test #1</field>
        <field name="note">Create directory and list its content</field>
        <field
            name="tag_ids"
            eval="[(6, 0, [ref('cetmix_tower_server.tag_staging')])]"
        />
    </record>
    <!-- Line -->
    <record id="plan_test_1_line_1" model="cx.tower.plan.line">
        <field name="sequence">5</field>
        <field name="plan_id" ref="plan_test_1" />
        <field name="command_id" ref="command_create_dir" />
    </record>
    <!-- Actions -->
    <record id="plan_test_1_line_1_action_1" model="cx.tower.plan.line.action">
        <field name="line_id" ref="plan_test_1_line_1" />
        <field name="sequence">1</field>
        <field name="condition">==</field>
        <field name="value_char">0</field>
    </record>
    <record id="plan_test_1_line_1_action_2" model="cx.tower.plan.line.action">
        <field name="line_id" ref="plan_test_1_line_1" />
        <field name="sequence">2</field>
        <field name="condition">&gt;</field>
        <field name="value_char">0</field>
        <field name="action">ec</field>
        <field name="custom_exit_code">255</field>
    </record>
    <!-- Line -->
    <record id="plan_test_1_line_2" model="cx.tower.plan.line">
        <field name="sequence">20</field>
        <field name="plan_id" ref="plan_test_1" />
        <field name="command_id" ref="command_list_dir" />
    </record>
    <!-- Actions -->
    <record id="plan_test_1_line_2_action_1" model="cx.tower.plan.line.action">
        <field name="line_id" ref="plan_test_1_line_2" />
        <field name="sequence">1</field>
        <field name="condition">==</field>
        <field name="value_char">-1</field>
        <field name="action">ec</field>
        <field name="custom_exit_code">100</field>
    </record>
    <record id="plan_test_1_line_2_action_2" model="cx.tower.plan.line.action">
        <field name="line_id" ref="plan_test_1_line_2" />
        <field name="sequence">2</field>
        <field name="condition">&gt;=</field>
        <field name="value_char">3</field>
        <field name="action">n</field>
    </record>

</odoo>
